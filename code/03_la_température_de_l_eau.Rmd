---
title: "Océan et climat : séance 3 'La température de l'eau'"
author: "Laurent Dubroca"
date: "`r date()`"
bibliography: '/home/moi/datahome/work/biblio/enfin/biblioloran.bib'
---


```{r global_options, include=T,cache=F,echo=F,warning=F,message=F,progress=F,verbose=F,results="hide"}
#knitr option
#operationnel<-TRUE
#knitr::opts_chunk$set(echo=FALSE, 
#		      warning=!operationnel, 
#		      message=!operationnel,
#		      fig.height=8,
#		      progress=!operationnel,
#		      verbose=!operationnel,
#		      include=TRUE,dev='jpeg',autodep=FALSE)
#package
#library(COSTcore);library(COSTdbe);library(COSTeda)
#library(dplyr);library(tidyr);library(stringr)
#library(ggplot2);library(gridExtra)
#library(sf)
##library(openxlsx);library(mailR)
#library(pander);library(captioner)
#library(mapdata)
#library(DATRAS)
#library(sparkTable)
#library(cardidates)
#library(lubridate)
#library(ggmap)
#library(osmdata)
#library(ggspatial)
#local fct
#source("credo_fct.R")
#initialise les fonctions pour légender tables et figures
#tabcap <- captioner(prefix = "Table")
#figcap <- captioner(prefix = "Figure")

#`r tabcap(name="info",caption="Stock id: area, species, catches.")`
#```{r,cache=T,eval=!param[1,2],echo=FALSE,results="asis"}
#cat("Empty section with no plot means no data.")
#```
#```{r tsplot1caption,cache=T,eval=tabtest[1,2],echo=FALSE,results="asis"}
#cat(figcap(name="tsarea",caption="Landings by ICES divsion."))
#```
#param
zone <- c(left = -2, bottom = 49, right = 2, top = 51)

```

**DRAFT/FRENCH/PRIMARY SCHOOL/SECOND GRADE**

# Objectifs 

Objectifs :

- fonctionnement de l'océan 
- circulation des masses d'eau vue par la température de l'eau
- les satellites d'observation
- résumer des cartes sous forme de série temporelle

- données Copernicus 


# Document

## test Carte

Test d'extraction de données satellitaires sur la baie de zone et cartographie
rapide.

### Température de surface

```{r testcarto,echo=T}
fct1<-function(chl){
#define hydro year position
	idtps<-data.frame(name=names(chl))%>%
		mutate(year=as.numeric(substr(name,7,10)),month=as.numeric(substr(name,12,13)))%>%
		mutate(yearhydro=ifelse(month<9,year,year+1))
	#average data by hydro year
	chl<-stackApply(chl,idtps$yearhydro,mean,na.rm=T)
 	return(chl)
}

library(rasterVis)
library(dplyr)
sst<-stack("/home/moi/ifremer/CAPES_NOURSEINE/icec2018/data/addedvalue/data/sst")
yearsst<-fct1(sst)
names(yearsst)<-gsub("index","sst",names(yearsst))
(levelplot(yearsst))#,zscaleLog=T))
```

### Concentration en chlorophylle a


```{r testcarto2,echo=T}
chl<-stack("/home/moi/ifremer/CAPES_NOURSEINE/icec2018/data/addedvalue/data/chl")
yearchl<-fct1(chl)
levelplot(yearchl,zscaleLog=T)
```



```{r testcarto3,echo=T,eval=F}

#kp490
kd490<-stack("./data/kd490")
datkd490<-fct1(kd490,newmapstrate,"kd490")
#bbp443
pipo<-stack("./data/bbp443")
datbbp443<-fct1(pipo,newmapstrate,"bbp443")
#cdm443
pipo<-stack("./data/cdm443")
datcdm443<-fct1(pipo,newmapstrate,"cdm443")
#spm
pipo<-stack("./data/spm")
datspm<-fct1(pipo,newmapstrate,"spm")
#sst
pipo<-stack("./data/sst")
datsst<-fct1(pipo,newmapstrate,"sst")



#prepare the world
library("rnaturalearth")
library("rnaturalearthdata")
library(ggplot2)
library(sf)
library(maps)
world <- ne_countries(scale = "medium", returnclass = "sf")
legendeworld<-data.frame(x=c(1,1,1,1),y=c(1.5,2,2.25,2.5),nom=c("Légende :","Terre","","Océan"))#,color=c("light grey","lightblue"))
aa<-ggplot()+geom_tile(data=legendeworld,aes(x=y,y=x,fill=nom),color="white")+
	scale_fill_manual(values=rev(c("lightgrey","lightblue","white","white")))+
	geom_text(data=legendeworld,aes(x=y,y=x,label=nom),size=3)+
	theme_void()+
	theme(legend.position="none")#+
	#coord_fixed()
#print(aa)


lemonde<-ggplot(data=world)+
geom_sf(data=world,colour="dark grey",fill="dark grey",show.legend=TRUE)+
coord_sf(expand=F)+theme_bw()+
 theme(panel.grid.major = element_line(colour = 'transparent'),
       panel.background = element_rect(fill = "lightblue", colour = "lightblue"))+
 ggtitle("Le monde")
#print(lemonde)

p1<-ggdraw()+
	draw_plot(lemonde,0,0,1,1)+
	draw_plot(aa,0.35,0.21,0.38,0.06)
print(p1)
```

